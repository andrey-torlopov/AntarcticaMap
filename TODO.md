## План доработки TiledMapKit

### 1. Создание независимой инфраструктуры

* Создать папку `LocalSPM/Libraries/TiledMapKit/`
* Настроить `Package.swift` с тремя таргетами:
  `TiledMapCore`, `TiledMapUI`, `TiledMapProviders`
* Добавить базовую структуру директорий и тестов

### 2. Перенос ядра (Core)

* Вынести из `MapDemo` утилиты расчёта (`TilesSupport.swift` → `TileCalculations.swift`)
* Определить протоколы:

  * `TileProvider` — асинхронная выдача тайлов
  * `TileRequest` — координаты и уровень
  * `TiledMapLogger` — опциональное логирование
* Добавить модель `TileConfiguration` с настройками зума и отладочного режима
* Написать юнит-тесты для расчётов уровней и зума

### 3. Перенос UI-слоя

* Вынести `MapTiledView` в `TiledMapUI/UIKit/`, убрать зависимости от `TilesSource`
* Извлечь контроллер из `AntarcticaTiledMapContentView`, адаптировать под протокол `TileProvider`
* Создать SwiftUI-обёртку `TiledMapView`, принимающую любой провайдер и опциональные контролы
* Заменить `Mazun`-стили на параметр `ButtonStyle` или `@ViewBuilder`-контролы
* Убрать зависимость от `Letopis`, внедрив `TiledMapLogger`

### 4. Асинхронность и кэширование

* Переделать загрузку тайлов на `async/await` через `URLSession`
* Добавить `TileCache` (на `NSCache` + диск)
* Сделать кэширование и повторное использование изображений
* Гарантировать, что UI обновляется на главном потоке после загрузки

### 5. Providers

* Добавить пример `RemoteImageTileProvider` с асинхронной загрузкой по URL
* Создать `MockTileProvider` для тестов
* Вынести `EarthDataTilesSource` в отдельный адаптер (`EarthDataTileProvider`) в `MapDemo`

### 6. Устранение зависимостей

* Удалить ссылки на `Models`, `Services`, `Nevod`, `Core`, `Mazun`, `Letopis`
* Проверить сборку пакета автономно, без проекта `SpaceZeroLab`

### 7. Документация и тесты

* Создать `README.md` с инструкцией, примером SwiftUI-использования и API-описанием
* Подготовить пример-приложение `Examples/TiledMapDemoApp`
* Добавить `LICENSE`, `CHANGELOG.md`, и настроить CI (`swift test`)

### 8. Интеграция в проект

* Подключить `TiledMapKit` как локальный пакет
* Переделать `MapDemo` для работы через `EarthDataTileProvider`
* Проверить работу UI, асинхронности и кэша

### 9. Расширения и обсуждения

* Определить, кто отвечает за кэширование — библиотека или провайдер
* Решить, нужны ли жесты pinch-to-zoom и панорамирования по умолчанию
* Обсудить добавление поддержки векторных тайлов
* Выбрать: держать библиотеку в монорепозитории или вынести в отдельный репозиторий

### 10. Возможное развитие (v2.0+)

* Предзагрузка соседних тайлов
* Анимация переходов между уровнями
* Поддержка разных картографических проекций
* API для аннотаций и офлайн-режима

---

Итог:
`TiledMapKit` станет лёгкой, независимой библиотекой без приватных зависимостей, с современным API, асинхронной загрузкой, кэшированием и возможностью подключать любые источники тайлов.
